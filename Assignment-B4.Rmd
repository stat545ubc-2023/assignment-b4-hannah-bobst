---
title: "Assignment B4"
author: "Hannah Bobst"
date: "December 7, 2023"
output: 
  html_document:
    theme: cerulean
    toc: true
    toc_depth: 5
    toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE}
# Load packages
library(tidyverse)
library(janeaustenr)
library(stopwords)
```


# Exercise 1
This exercise creates a bar graph of the 20 most common words in the *emma* data set from the *janeaustenr* package. 

### Preparing the data
The data must be prepared before it may be plotted. 
First, each word is made into a single element of the data set. 
The list format is removed so that the data set is a single vector, and all words are converted to be completely lower case. 
The blank observations and punctuation are then removed.
Afterward, all the stop words from the *stopwords* package are removed, and this subset of data is converted to a data frame (for plotting). 
A summary table is then created which summarizes the amount of times each word appears.
This table is sorted from most the common to least common words. 
Finally, the table is truncated so that only the 20 most common words are included.

```{r message=FALSE}
# Create lowercase subset of "emma" data set without stop punctuation and blank entries
emma_subset <- emma %>%
  str_split(pattern=" ") %>%
  unlist() %>%
  tolower() %>%
  str_subset(pattern="") %>%
  str_remove_all(pattern="[.:;,?()_!&]") %>%
  str_remove_all(pattern="\"") %>%
  str_remove_all(pattern="--")

# Subset "emma" further without stopwords (from "stopwords" package)
emma_subset <- emma_subset[(emma_subset %in% stopwords()) == FALSE] 

# Make "emma_subset" into a data frame
emma_subset_df <- data.frame("words" = emma_subset)

# Summarize counts of words and order largest to smallest
emma_counts <- emma_subset_df %>%
  count(words) %>%
  arrange(desc(n))

# Select the 20 most common words for plotting
emma_counts_20 <- emma_counts[1:20,]
```

### Plotting the data
A bar plot is created for the 20 most common words in the *emma* data set. 

```{r message=FALSE}
# Plot the 20 most common words
emma_counts_20 %>%
  ggplot(aes(x = reorder(words, n), y = n)) + 
  geom_col(fill = "darksalmon") + 
  coord_flip() + 
  guides(fill = "none") + 
  geom_text(aes(label=n), hjust = 1.2, colour="white") + 
  ggtitle("20 Most Common Words in Emma") + 
  xlab("Words") + 
  ylab("Word Count")
```

# Exercise 2

### Function
A function *pig_latin_mod* is created which converts a vector of character data (one word per observation) to a modified version of Pig Latin. 

This modified Pig Latin has the following rearrangement rules: 

* For words that end with a vowel, all of the last vowels (until the first consonant) are moved to the beginning of the word. 

* For words that end with a consonant, all of the last consonants (until the last vowel) are moved to the beginning of the word 

In addition, this modified Pig Latin has the following addition rule: 

* Add "ya" to the beginning of each word (after the rearrangement rule has been performed)

For example, the word *about* becomes *yatabou*. 
This is because consonant (up until the last vowel) *t* has been moved from the end to the beginning, and *ya* has been added to the beginning.

Similarly, the word *argue* become *yauearg*.
This is because the vowels (up until the last consonant) *ue* have been moved from the end to the beginning, and *ya* has been added to the beginning.

The user may specify to remove all punctuation (*remove_punctuation* = TRUE) and to convert all words to lower case (*lower_case* = FALSE). 
By default, both these options are FALSE. 

```{r message=FALSE}
#' @title Convert words to modified Pig Latin 
#'
#' @description pig_latin_mod takes a vector of character data (one word per observation) and converts each observation to a modified version of Pig Latin.
#'
#' @param data An atomic vector. This vector contains the words to be converted to the modified Pig Latin. 
#' @param remove_punctuation A Boolean variable. If TRUE, the function removes all punctuation from the data vector. The default is FALSE. 
#' @param lower_case A Boolean variable. If TRUE, the function converts all words to lower case. The default is FALSE.
#' @return An atomic vector with the observations from "data" converted to the modified Pig Latin.
#' 
#' @import tidyverse
#' @export
pig_latin_mod <- function(data, remove_punctuation = FALSE, lower_case = FALSE){
  # Check if input data is a vector
  if(!is.vector(data)){
    # If data isn't a vector, stop function with an error 
    stop("Input data must be a vector.")
  }
  # Check if the vector has character data 
  if(!is.character(data)){
    # If the vector doesn't have character data, stop function with an error
    stop("Input vector must have character data.")
  }
  # Check if the vector multiple words (blank space between characters) 
  if(TRUE %in% str_detect(data, pattern = " ")){
    # If multiple words, stop function with an error
    stop("Input vector must only have one word per observation.")
  }
  # Check if remove_punctuation argument is true
  if(remove_punctuation == TRUE){
    # Remove punctuation from each word
    data <- str_remove_all(data, pattern = "[^a-z,A-Z]")
  }
  # Check if lower_case argument is true
  if(lower_case == TRUE){
    # Convert all words to lower case
    data <- tolower(data)
  }
  
  # Function to detect if a letter is a vowel 
  is_vowel <- function(x) x %in% c("a", "e", "i", "o", "u", "A", "E", "I", "O", "U")
  # Function to detect if a letter is a consonant
  is_consonant <- function(x) !(x %in% c("a", "e", "i", "o", "u", "A", "E", "I", "O", "U"))
  
  # Map each letter in function 
  map_vec(data, function(x){
    # Split current word by letter
    data_letters <- str_split(x, "")[[1]]
    
    # Find letter at the end of the current word
    end_letter <- str_sub(x, start=-1)
    
    # Find last vowel index for the current word
    last_vowel <- detect_index(data_letters, is_vowel, .dir="backward")
    # Find last consonant index for the current word
    last_con <- detect_index(data_letters, is_consonant, .dir="backward")
  
    # If the last letter is a consonant 
    if(is_consonant(end_letter) == TRUE){
      # Move letters (until last vowel) from the end to the beginning and add "ya" to the beginning
      str_c("ya", str_sub(x, start=last_vowel+1), str_sub(x, end=last_vowel))
    } else{
      # Move letters (until last consonant) from the end to the beginning and add "ya" to beginning
      str_c("ya", str_sub(x, start=last_con+1), str_sub(x, end=last_con))
    }
  })
  
}
```


### Examples
This section includes examples using the function *pig_latin_mod*.

#### Example 1
This example demonstrates the function using the first 20 words in the data set *words*.

```{r message=FALSE}
# Print original values
words[1:20]

# Print values converted into the modified Pig Latin 
pig_latin_mod(words[1:20])
```

#### Example 2
This example demonstrates the function using a single observation. 
The single observation in this case is the 50th word in the data set *words*.

```{r message=FALSE}
# Print original value 
words[50]

# Print value converted into the modified Pig Latin 
pig_latin_mod(words[50])
```

#### Example 3
This example demonstrates the *remove_punctuation* parameter. 
A vector of words which may contain punctuation is made for illustration. 

```{r message=FALSE}
# Make vector of words
sample_words1 <- c("the", "able", "therefore", "can't", "found.")

# Print original values
sample_words1

# Convert values to modified Pig Latin with punctuation
pig_latin_mod(sample_words1, remove_punctuation = FALSE)

# Convert values to modified Pig Latin without punctuation
pig_latin_mod(sample_words1, remove_punctuation = TRUE)
```


#### Example 4
This example demonstrates the *lower_case* parameter. 
A vector of words which may contain capital letters is made for illustration. 

```{r message=FALSE}
# Make sample vector of words
sample_words2 <- c("The", "able", "May", "June", "therefore")

# Print original values
sample_words2

# Convert values to modified Pig Latin with capital letters
pig_latin_mod(sample_words2, lower_case = FALSE)

# Convert values to modified Pig Latin with capital letters
pig_latin_mod(sample_words2, lower_case = TRUE)
```


### Tests
